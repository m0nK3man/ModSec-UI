<!-- templates/rules.html -->
{% extends "base.html" %}
{% block content %}

<div class="rules-header">
    <div class="mode-toggle">
        <a href="{{ url_for('rules.rules', view_mode='view') }}" 
           class="button {% if view_mode == 'view' %}active{% endif %}">View Mode</a>
        <a href="{{ url_for('rules.rules', view_mode='edit') }}" 
           class="button {% if view_mode == 'edit' %}active{% endif %}">Edit Mode</a>
    </div>
    
    <form action="{{ url_for('rules.commit_changes_view') }}" method="post" class="commit-form">
        <button type="submit" 
                class="button {% if not (enabled_rules|selectattr('changed', 'true')|list + disabled_rules|selectattr('changed', 'true')|list) %}disabled{% endif %}"
                {% if not (enabled_rules|selectattr('changed', 'true')|list + disabled_rules|selectattr('changed', 'true')|list) %}disabled{% endif %}>
            Commit Changes
        </button>
    </form>
</div>

<div class="rule-block">
    <h2>Enabled Rules</h2>
    <table>
        <tr>
            <th>Rule File</th>
            <th>Status</th>
            <th>File Status</th>
            {% if view_mode == 'edit' %}
            <th>Actions</th>
            {% endif %}
        </tr>
        {% for rule in enabled_rules %}
        <tr class="{% if rule.changed %}changed{% endif %}">
            <td>{{ rule.filename }}</td>
            <td>Enabled</td>
            <td>{{ 'Changed' if rule.changed else 'Unchanged' }}</td>
            {% if view_mode == 'edit' %}
            <td>
                <a class="button" href="{{ url_for('rules.toggle_rule_view', filename=rule.filename, view_mode=view_mode) }}">Disable</a> |
                <a class="button" href="{{ url_for('rules.edit_rule', filename=rule.filename, view_mode=view_mode) }}">Edit</a>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
</div>

<div class="rule-block">
    <h2>Disabled Rules</h2>
    <table>
        <tr>
            <th>Rule File</th>
            <th>Status</th>
            <th>File Status</th>
            {% if view_mode == 'edit' %}
            <th>Actions</th>
            {% endif %}
        </tr>
        {% for rule in disabled_rules %}
        <tr class="{% if rule.changed %}changed{% endif %}">
            <td>{{ rule.filename.lstrip('.') }}</td>
            <td>Disabled</td>
            <td>{{ 'Changed' if rule.changed else 'Unchanged' }}</td>
            {% if view_mode == 'edit' %}
            <td>
                <a class="button" href="{{ url_for('rules.toggle_rule_view', filename=rule.filename, view_mode=view_mode) }}">Enable</a> |
                <a class="button" href="{{ url_for('rules.edit_rule', filename=rule.filename, view_mode=view_mode) }}">Edit</a>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
</div>

{% endblock %}
